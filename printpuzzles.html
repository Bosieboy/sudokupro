<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Printable Sudoku Puzzles</title>
    <style>
        :root {
            --primary-color: #34495e;
            --secondary-color: #ecf0f1;
            --page-bg-color: #fff;
            --grid-line-color: #000;
            --font-color: #000;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--primary-color);
            color: var(--font-color);
            margin: 0;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .controls {
            background-color: var(--secondary-color);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            text-align: center;
            margin-bottom: 20px;
        }

        .controls h1 {
            color: var(--primary-color);
            margin-top: 0;
        }

        #folder-selector {
            font-size: 16px;
            cursor: pointer;
            padding: 10px;
        }
        
        #print-button {
            display: none; /* Hide until puzzles are loaded */
            margin-top: 15px;
            padding: 10px 20px;
            font-size: 16px;
            color: #fff;
            background-color: var(--primary-color);
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #print-button:hover {
            background-color: #2c3e50;
        }

        .loading {
            margin-top: 20px;
            color: var(--secondary-color);
        }

        /* --- Print-optimized CSS starts here --- */
        #pages-container {
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .printable-page {
            width: 210mm; /* A4 width */
            background-color: var(--page-bg-color);
            margin: 20px auto;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
            padding: 5mm;
            box-sizing: border-box;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
            align-content: space-between;
            position: relative;
            /* Hoogte is nu dynamisch om lege pagina's te voorkomen */
        }

        .puzzle-wrapper {
            position: relative;
            display: flex;
            flex-direction: column;
            width: 49%; /* Allows two puzzles side-by-side with a small gap */
            height: 48%; /* Allows two rows of puzzles */
        }

        .puzzle-title {
            text-align: left;
            margin-bottom: 2mm;
            font-size: 12px;
            font-weight: 600;
        }

        .sudoku-grid {
            display: grid;
            grid-template-columns: repeat(9, 1fr);
            aspect-ratio: 1 / 1;
            width: 100%;
            border-top: 3px solid var(--grid-line-color);
            border-left: 3px solid var(--grid-line-color);
            box-sizing: border-box;
        }

        .sudoku-cell {
            aspect-ratio: 1 / 1;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 10px; /* Slightly bigger font */
            font-weight: 600;
            border-right: 2px solid var(--grid-line-color);
            border-bottom: 2px solid var(--grid-line-color);
            box-sizing: border-box;
        }
        
        /* Dikke verticale lijnen voor kolommen 3, 6 en 9 */
        .sudoku-cell:nth-child(9n+3),
        .sudoku-cell:nth-child(9n+6),
        .sudoku-cell:nth-child(9n+9) {
            border-right-width: 3px;
        }

        /* Dikke horizontale lijnen voor rijen 3, 6 en 9 */
        .sudoku-cell:nth-child(n+19):nth-child(-n+27),
        .sudoku-cell:nth-child(n+46):nth-child(-n+54),
        .sudoku-cell:nth-child(n+73):nth-child(-n+81) {
            border-bottom-width: 3px;
        }
        
        .page-footer {
            position: absolute;
            bottom: 5mm;
            width: 90%;
            text-align: center;
            font-size: 10px;
            color: #555;
            left: 50%;
            transform: translateX(-50%);
        }
        
        @media print {
            body {
                background-color: var(--page-bg-color);
                margin: 0;
                padding: 0;
            }
            .controls {
                display: none;
            }
            .printable-page {
                box-shadow: none;
                margin: 0;
                padding: 10mm;
                page-break-after: always;
            }
            .printable-page:last-child {
                page-break-after: avoid;
            }
        }
    </style>
</head>
<body>
    <div class="controls">
        <h1>Printable Sudoku Puzzles</h1>
        <p>Selecteer de map met je onopgeloste puzzels (`unsolved_puzzles`).</p>
        <input type="file" id="folder-selector" webkitdirectory directory multiple>
        <button id="print-button" onclick="window.print()">Print Pagina's</button>
        <p id="status-message" class="loading"></p>
    </div>

    <div id="pages-container"></div>

    <script>
        document.getElementById('folder-selector').addEventListener('change', async (event) => {
            const files = Array.from(event.target.files).filter(file => file.name.endsWith('.txt'));
            const statusMessage = document.getElementById('status-message');
            const pagesContainer = document.getElementById('pages-container');
            const printButton = document.getElementById('print-button');
            
            pagesContainer.innerHTML = '';
            printButton.style.display = 'none';

            if (files.length === 0) {
                statusMessage.textContent = "Geen .txt-bestanden gevonden in de geselecteerde map.";
                return;
            }
            
            statusMessage.textContent = "Puzzels laden...";
            
            // Sorteer bestanden numeriek om de juiste volgorde te garanderen
            files.sort((a, b) => {
                const numA = parseInt(a.name.match(/\d+/)[0]);
                const numB = parseInt(b.name.match(/\d+/)[0]);
                return numA - numB;
            });

            const puzzles = [];
            const readers = files.map(file => {
                return new Promise(resolve => {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const grid = e.target.result.trim().split('\n').map(row => row.split(' ').map(Number));
                        puzzles.push({ name: file.name, grid });
                        resolve();
                    };
                    reader.readAsText(file);
                });
            });

            await Promise.all(readers);
            
            puzzles.sort((a, b) => {
                const numA = parseInt(a.name.match(/\d+/)[0]);
                const numB = parseInt(b.name.match(/\d+/)[0]);
                return numA - numB;
            });
            
            statusMessage.textContent = `Puzzels geladen: ${puzzles.length}. Pagina's genereren...`;

            let pageCount = 0;
            for (let i = 0; i < puzzles.length; i += 4) {
                pageCount++;
                const page = document.createElement('div');
                page.classList.add('printable-page');

                const pageFooter = document.createElement('div');
                pageFooter.classList.add('page-footer');
                pageFooter.textContent = `Pagina ${pageCount}`;
                page.appendChild(pageFooter);

                for (let j = 0; j < 4 && (i + j) < puzzles.length; j++) {
                    const puzzleData = puzzles[i + j];
                    const puzzleWrapper = document.createElement('div');
                    puzzleWrapper.classList.add('puzzle-wrapper');

                    const title = document.createElement('div');
                    title.classList.add('puzzle-title');
                    title.textContent = `Puzzel ${i + j + 1}`;
                    puzzleWrapper.appendChild(title);
                    
                    const gridElement = document.createElement('div');
                    gridElement.classList.add('sudoku-grid');
                    
                    for (let row = 0; row < 9; row++) {
                        for (let col = 0; col < 9; col++) {
                            const cell = document.createElement('div');
                            cell.classList.add('sudoku-cell');
                            const value = puzzleData.grid[row][col];
                            cell.textContent = value !== 0 ? value : '';
                            gridElement.appendChild(cell);
                        }
                    }
                    puzzleWrapper.appendChild(gridElement);
                    page.appendChild(puzzleWrapper);
                }
                pagesContainer.appendChild(page);
            }
            
            const totalPages = Math.ceil(puzzles.length / 4);
            const doubleSidedPages = Math.ceil(totalPages / 2);
            statusMessage.textContent = `Gegenereerd: ${totalPages} pagina's voor afdrukken. Dit zijn ${doubleSidedPages} dubbelzijdige pagina's.`;
            printButton.style.display = 'block';
        });
    </script>
</body>
</html>